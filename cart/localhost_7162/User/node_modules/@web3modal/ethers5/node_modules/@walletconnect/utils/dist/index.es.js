import{ChaCha20Poly1305 as ue}from"@stablelib/chacha20poly1305";import{HKDF as En}from"@stablelib/hkdf";import{randomBytes as le}from"@stablelib/random";import{SHA256 as bn,hash as de}from"@stablelib/sha256";import*as fe from"@stablelib/x25519";import{toString as v,fromString as E,concat as pe}from"uint8arrays";import{detect as Nn}from"detect-browser";import{toMiliseconds as W,FIVE_MINUTES as me,fromMiliseconds as On}from"@walletconnect/time";import{getDocument as Sn,getNavigator as ye,getLocation as he}from"@walletconnect/window-getters";import{getWindowMetadata as wn}from"@walletconnect/window-metadata";import*as V from"query-string";import{RELAY_JSONRPC as In}from"@walletconnect/relay-api";const M=":";function ge(e){const[n,t]=e.split(M);return{namespace:n,reference:t}}function ve(e){const{namespace:n,reference:t}=e;return[n,t].join(M)}function z(e){const[n,t,r]=e.split(M);return{namespace:n,reference:t,address:r}}function Ee(e){const{namespace:n,reference:t,address:r}=e;return[n,t,r].join(M)}function Y(e,n){const t=[];return e.forEach(r=>{const o=n(r);t.includes(o)||t.push(o)}),t}function be(e){const{address:n}=z(e);return n}function Ne(e){const{namespace:n,reference:t}=z(e);return ve({namespace:n,reference:t})}function Pn(e,n){const{namespace:t,reference:r}=ge(n);return Ee({namespace:t,reference:r,address:e})}function Tn(e){return Y(e,be)}function Oe(e){return Y(e,Ne)}function Rn(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...o.accounts)}),t}function An(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...Oe(o.accounts))}),t}function Un(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const o=e[r];t.push(...K(r,o))}),t}function K(e,n){return e.includes(":")?[e]:n.chains||[]}const L=e=>e?.split(":"),Se=e=>{const n=e&&L(e);if(n)return n[3]},_n=e=>{const n=e&&L(e);if(n)return n[2]+":"+n[3]},we=e=>{const n=e&&L(e);if(n)return n.pop()},Cn=(e,n)=>{const t=`${e.domain} wants you to sign in with your Ethereum account:`,r=we(n),o=e.statement,s=`URI: ${e.aud}`,i=`Version: ${e.version}`,d=`Chain ID: ${Se(n)}`,l=`Nonce: ${e.nonce}`,c=`Issued At: ${e.iat}`,u=e.resources&&e.resources.length>0?`Resources:
${e.resources.map(a=>`- ${a}`).join(`
`)}`:void 0;return[t,r,"",o,"",s,i,d,l,c,u].filter(a=>a!=null).join(`
`)},J="base10",p="base16",x="base64pad",F="utf8",Q=0,_=1,$n=0,Ie=1,Z=12,X=32;function jn(){const e=fe.generateKeyPair();return{privateKey:v(e.secretKey,p),publicKey:v(e.publicKey,p)}}function Dn(){const e=le(X);return v(e,p)}function kn(e,n){const t=fe.sharedKey(E(e,p),E(n,p),!0),r=new En(bn,t).expand(X);return v(r,p)}function Vn(e){const n=de(E(e,p));return v(n,p)}function Mn(e){const n=de(E(e,F));return v(n,p)}function Pe(e){return E(`${e}`,J)}function j(e){return Number(v(e,J))}function Kn(e){const n=Pe(typeof e.type<"u"?e.type:Q);if(j(n)===_&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof e.senderPublicKey<"u"?E(e.senderPublicKey,p):void 0,r=typeof e.iv<"u"?E(e.iv,p):le(Z),o=new ue(E(e.symKey,p)).seal(r,E(e.message,F));return Te({type:n,sealed:o,iv:r,senderPublicKey:t})}function Ln(e){const n=new ue(E(e.symKey,p)),{sealed:t,iv:r}=ee(e.encoded),o=n.open(r,t);if(o===null)throw new Error("Failed to decrypt");return v(o,F)}function Te(e){if(j(e.type)===_){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return v(pe([e.type,e.senderPublicKey,e.iv,e.sealed]),x)}return v(pe([e.type,e.iv,e.sealed]),x)}function ee(e){const n=E(e,x),t=n.slice($n,Ie),r=Ie;if(j(t)===_){const d=r+X,l=d+Z,c=n.slice(r,d),u=n.slice(d,l),a=n.slice(l);return{type:t,sealed:a,iv:u,senderPublicKey:c}}const o=r+Z,s=n.slice(r,o),i=n.slice(o);return{type:t,sealed:i,iv:s}}function xn(e,n){const t=ee(e);return Re({type:j(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?v(t.senderPublicKey,p):void 0,receiverPublicKey:n?.receiverPublicKey})}function Re(e){const n=e?.type||Q;if(n===_){if(typeof e?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:n,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function Fn(e){return e.type===_&&typeof e.senderPublicKey=="string"&&typeof e.receiverPublicKey=="string"}var Hn=Object.defineProperty,Ae=Object.getOwnPropertySymbols,qn=Object.prototype.hasOwnProperty,Bn=Object.prototype.propertyIsEnumerable,Ue=(e,n,t)=>n in e?Hn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,_e=(e,n)=>{for(var t in n||(n={}))qn.call(n,t)&&Ue(e,t,n[t]);if(Ae)for(var t of Ae(n))Bn.call(n,t)&&Ue(e,t,n[t]);return e};const Ce="ReactNative",m={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},H=" ",Gn=":",$e="/",ne=2,Wn=1e3,je="js";function te(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function C(){return!Sn()&&!!ye()&&navigator.product===Ce}function q(){return!te()&&!!ye()}function R(){return C()?m.reactNative:te()?m.node:q()?m.browser:m.unknown}function zn(){var e;try{return C()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(e=global.Application)==null?void 0:e.applicationId:void 0}catch{return}}function De(e,n){let t=V.parse(e);return t=_e(_e({},t),n),e=V.stringify(t),e}function Yn(){return wn()||{name:"",description:"",url:"",icons:[""]}}function Jn(e,n){var t;const r=R(),o={protocol:e,version:n,env:r};return r==="browser"&&(o.host=((t=he())==null?void 0:t.host)||"unknown"),o}function ke(){if(R()===m.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:r}=global.Platform;return[t,r].join("-")}const e=Nn();if(e===null)return"unknown";const n=e.os?e.os.replace(" ","").toLowerCase():"unknown";return e.type==="browser"?[n,e.name,e.version].join("-"):[n,e.version].join("-")}function Ve(){var e;const n=R();return n===m.browser?[n,((e=he())==null?void 0:e.host)||"unknown"].join(":"):n}function Me(e,n,t){const r=ke(),o=Ve();return[[e,n].join("-"),[je,t].join("-"),r,o].join("/")}function Qn({protocol:e,version:n,relayUrl:t,sdkVersion:r,auth:o,projectId:s,useOnCloseEvent:i,bundleId:d}){const l=t.split("?"),c=Me(e,n,r),u={auth:o,ua:c,projectId:s,useOnCloseEvent:i||void 0,origin:d||void 0},a=De(l[1]||"",u);return l[0]+"?"+a}function Zn(e){let n=(e.match(/^[^:]+(?=:\/\/)/gi)||[])[0];const t=typeof n<"u"?e.split("://")[1]:e;return n=n==="wss"?"https":"http",[n,t].join("://")}function Xn(e,n,t){if(!e[n]||typeof e[n]!==t)throw new Error(`Missing or invalid "${n}" param`)}function Ke(e,n=ne){return Le(e.split($e),n)}function et(e){return Ke(e).join(H)}function O(e,n){return e.filter(t=>n.includes(t)).length===e.length}function Le(e,n=ne){return e.slice(Math.max(e.length-n,0))}function nt(e){return Object.fromEntries(e.entries())}function tt(e){return new Map(Object.entries(e))}function rt(e,n){const t={};return Object.keys(e).forEach(r=>{t[r]=n(e[r])}),t}const ot=e=>e;function xe(e){return e.trim().replace(/^\w/,n=>n.toUpperCase())}function st(e){return e.split(H).map(n=>xe(n)).join(H)}function it(e=me,n){const t=W(e||me);let r,o,s;return{resolve:i=>{s&&r&&(clearTimeout(s),r(i))},reject:i=>{s&&o&&(clearTimeout(s),o(i))},done:()=>new Promise((i,d)=>{s=setTimeout(()=>{d(new Error(n))},t),r=i,o=d})}}function ct(e,n,t){return new Promise(async(r,o)=>{const s=setTimeout(()=>o(new Error(t)),n);try{const i=await e;r(i)}catch(i){o(i)}clearTimeout(s)})}function re(e,n){if(typeof n=="string"&&n.startsWith(`${e}:`))return n;if(e.toLowerCase()==="topic"){if(typeof n!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${n}`}else if(e.toLowerCase()==="id"){if(typeof n!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${n}`}throw new Error(`Unknown expirer target type: ${e}`)}function at(e){return re("topic",e)}function ut(e){return re("id",e)}function lt(e){const[n,t]=e.split(":"),r={id:void 0,topic:void 0};if(n==="topic"&&typeof t=="string")r.topic=t;else if(n==="id"&&Number.isInteger(Number(t)))r.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${n}:${t}`);return r}function dt(e,n){return On((n||Date.now())+W(e))}function ft(e){return Date.now()>=W(e)}function pt(e,n){return`${e}${n?`:${n}`:""}`}function S(e=[],n=[]){return[...new Set([...e,...n])]}async function mt({id:e,topic:n,wcDeepLink:t}){try{if(!t)return;const r=typeof t=="string"?JSON.parse(t):t;let o=r?.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const s=`${o}/wc?requestId=${e}&sessionTopic=${n}`,i=R();i===m.browser?s.startsWith("https://")?window.open(s,"_blank","noreferrer noopener"):window.open(s,"_self","noreferrer noopener"):i===m.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(r){console.error(r)}}const Fe="irn";function yt(e){return e?.relay||{protocol:Fe}}function ht(e){const n=In[e];if(typeof n>"u")throw new Error(`Relay Protocol not supported: ${e}`);return n}var gt=Object.defineProperty,He=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable,qe=(e,n,t)=>n in e?gt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,bt=(e,n)=>{for(var t in n||(n={}))vt.call(n,t)&&qe(e,t,n[t]);if(He)for(var t of He(n))Et.call(n,t)&&qe(e,t,n[t]);return e};function Be(e,n="-"){const t={},r="relay"+n;return Object.keys(e).forEach(o=>{if(o.startsWith(r)){const s=o.replace(r,""),i=e[o];t[s]=i}}),t}function Nt(e){e=e.includes("wc://")?e.replace("wc://",""):e,e=e.includes("wc:")?e.replace("wc:",""):e;const n=e.indexOf(":"),t=e.indexOf("?")!==-1?e.indexOf("?"):void 0,r=e.substring(0,n),o=e.substring(n+1,t).split("@"),s=typeof t<"u"?e.substring(t):"",i=V.parse(s);return{protocol:r,topic:Ge(o[0]),version:parseInt(o[1],10),symKey:i.symKey,relay:Be(i)}}function Ge(e){return e.startsWith("//")?e.substring(2):e}function We(e,n="-"){const t="relay",r={};return Object.keys(e).forEach(o=>{const s=t+n+o;e[o]&&(r[s]=e[o])}),r}function Ot(e){return`${e.protocol}:${e.topic}@${e.version}?`+V.stringify(bt({symKey:e.symKey},We(e.relay)))}var St=Object.defineProperty,wt=Object.defineProperties,It=Object.getOwnPropertyDescriptors,ze=Object.getOwnPropertySymbols,Pt=Object.prototype.hasOwnProperty,Tt=Object.prototype.propertyIsEnumerable,Ye=(e,n,t)=>n in e?St(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Rt=(e,n)=>{for(var t in n||(n={}))Pt.call(n,t)&&Ye(e,t,n[t]);if(ze)for(var t of ze(n))Tt.call(n,t)&&Ye(e,t,n[t]);return e},At=(e,n)=>wt(e,It(n));function A(e){const n=[];return e.forEach(t=>{const[r,o]=t.split(":");n.push(`${r}:${o}`)}),n}function Je(e){const n=[];return Object.values(e).forEach(t=>{n.push(...A(t.accounts))}),n}function Qe(e,n){const t=[];return Object.values(e).forEach(r=>{A(r.accounts).includes(n)&&t.push(...r.methods)}),t}function Ze(e,n){const t=[];return Object.values(e).forEach(r=>{A(r.accounts).includes(n)&&t.push(...r.events)}),t}function Ut(e,n){const t=cn(e,n);if(t)throw new Error(t.message);const r={};for(const[o,s]of Object.entries(e))r[o]={methods:s.methods,events:s.events,chains:s.accounts.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)};return r}function _t(e){const{proposal:{requiredNamespaces:n,optionalNamespaces:t={}},supportedNamespaces:r}=e,o=se(n),s=se(t),i={};Object.keys(r).forEach(c=>{const u=r[c].chains,a=r[c].methods,b=r[c].events,I=r[c].accounts;u.forEach(y=>{if(!I.some(f=>f.includes(y)))throw new Error(`No accounts provided for chain ${y} in namespace ${c}`)}),i[c]={chains:u,methods:a,events:b,accounts:I}});const d=un(n,i,"approve()");if(d)throw new Error(d.message);const l={};return!Object.keys(n).length&&!Object.keys(t).length?i:(Object.keys(o).forEach(c=>{const u=r[c].chains.filter(y=>{var f,g;return(g=(f=o[c])==null?void 0:f.chains)==null?void 0:g.includes(y)}),a=r[c].methods.filter(y=>{var f,g;return(g=(f=o[c])==null?void 0:f.methods)==null?void 0:g.includes(y)}),b=r[c].events.filter(y=>{var f,g;return(g=(f=o[c])==null?void 0:f.events)==null?void 0:g.includes(y)}),I=u.map(y=>r[c].accounts.filter(f=>f.includes(`${y}:`))).flat();l[c]={chains:u,methods:a,events:b,accounts:I}}),Object.keys(s).forEach(c=>{var u,a,b,I,y,f;if(!r[c])return;const g=(a=(u=s[c])==null?void 0:u.chains)==null?void 0:a.filter(P=>r[c].chains.includes(P)),hn=r[c].methods.filter(P=>{var T,$;return($=(T=s[c])==null?void 0:T.methods)==null?void 0:$.includes(P)}),gn=r[c].events.filter(P=>{var T,$;return($=(T=s[c])==null?void 0:T.events)==null?void 0:$.includes(P)}),vn=g?.map(P=>r[c].accounts.filter(T=>T.includes(`${P}:`))).flat();l[c]={chains:S((b=l[c])==null?void 0:b.chains,g),methods:S((I=l[c])==null?void 0:I.methods,hn),events:S((y=l[c])==null?void 0:y.events,gn),accounts:S((f=l[c])==null?void 0:f.accounts,vn)}}),l)}function oe(e){return e.includes(":")}function Xe(e){return oe(e)?e.split(":")[0]:e}function se(e){var n,t,r;const o={};if(!B(e))return o;for(const[s,i]of Object.entries(e)){const d=oe(s)?[s]:i.chains,l=i.methods||[],c=i.events||[],u=Xe(s);o[u]=At(Rt({},o[u]),{chains:S(d,(n=o[u])==null?void 0:n.chains),methods:S(l,(t=o[u])==null?void 0:t.methods),events:S(c,(r=o[u])==null?void 0:r.events)})}return o}const Ct={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},$t={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function N(e,n){const{message:t,code:r}=$t[e];return{message:n?`${t} ${n}`:t,code:r}}function U(e,n){const{message:t,code:r}=Ct[e];return{message:n?`${t} ${n}`:t,code:r}}function D(e,n){return Array.isArray(e)?typeof n<"u"&&e.length?e.every(n):!0:!1}function B(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function w(e){return typeof e>"u"}function h(e,n){return n&&w(e)?!0:typeof e=="string"&&!!e.trim().length}function G(e,n){return n&&w(e)?!0:typeof e=="number"&&!isNaN(e)}function jt(e,n){const{requiredNamespaces:t}=n,r=Object.keys(e.namespaces),o=Object.keys(t);let s=!0;return O(o,r)?(r.forEach(i=>{const{accounts:d,methods:l,events:c}=e.namespaces[i],u=A(d),a=t[i];(!O(K(i,a),u)||!O(a.methods,l)||!O(a.events,c))&&(s=!1)}),s):!1}function k(e){return h(e,!1)&&e.includes(":")?e.split(":").length===2:!1}function en(e){if(h(e,!1)&&e.includes(":")){const n=e.split(":");if(n.length===3){const t=n[0]+":"+n[1];return!!n[2]&&k(t)}}return!1}function Dt(e){if(h(e,!1))try{return typeof new URL(e)<"u"}catch{return!1}return!1}function kt(e){var n;return(n=e?.proposer)==null?void 0:n.publicKey}function Vt(e){return e?.topic}function Mt(e,n){let t=null;return h(e?.publicKey,!1)||(t=N("MISSING_OR_INVALID",`${n} controller public key should be a string`)),t}function ie(e){let n=!0;return D(e)?e.length&&(n=e.every(t=>h(t,!1))):n=!1,n}function nn(e,n,t){let r=null;return D(n)&&n.length?n.forEach(o=>{r||k(o)||(r=U("UNSUPPORTED_CHAINS",`${t}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):k(e)||(r=U("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function tn(e,n,t){let r=null;return Object.entries(e).forEach(([o,s])=>{if(r)return;const i=nn(o,K(o,s),`${n} ${t}`);i&&(r=i)}),r}function rn(e,n){let t=null;return D(e)?e.forEach(r=>{t||en(r)||(t=U("UNSUPPORTED_ACCOUNTS",`${n}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):t=U("UNSUPPORTED_ACCOUNTS",`${n}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function on(e,n){let t=null;return Object.values(e).forEach(r=>{if(t)return;const o=rn(r?.accounts,`${n} namespace`);o&&(t=o)}),t}function sn(e,n){let t=null;return ie(e?.methods)?ie(e?.events)||(t=U("UNSUPPORTED_EVENTS",`${n}, events should be an array of strings or empty array for no events`)):t=U("UNSUPPORTED_METHODS",`${n}, methods should be an array of strings or empty array for no methods`),t}function ce(e,n){let t=null;return Object.values(e).forEach(r=>{if(t)return;const o=sn(r,`${n}, namespace`);o&&(t=o)}),t}function Kt(e,n,t){let r=null;if(e&&B(e)){const o=ce(e,n);o&&(r=o);const s=tn(e,n,t);s&&(r=s)}else r=N("MISSING_OR_INVALID",`${n}, ${t} should be an object with data`);return r}function cn(e,n){let t=null;if(e&&B(e)){const r=ce(e,n);r&&(t=r);const o=on(e,n);o&&(t=o)}else t=N("MISSING_OR_INVALID",`${n}, namespaces should be an object with data`);return t}function an(e){return h(e.protocol,!0)}function Lt(e,n){let t=!1;return n&&!e?t=!0:e&&D(e)&&e.length&&e.forEach(r=>{t=an(r)}),t}function xt(e){return typeof e=="number"}function Ft(e){return typeof e<"u"&&typeof e!==null}function Ht(e){return!(!e||typeof e!="object"||!e.code||!G(e.code,!1)||!e.message||!h(e.message,!1))}function qt(e){return!(w(e)||!h(e.method,!1))}function Bt(e){return!(w(e)||w(e.result)&&w(e.error)||!G(e.id,!1)||!h(e.jsonrpc,!1))}function Gt(e){return!(w(e)||!h(e.name,!1))}function Wt(e,n){return!(!k(n)||!Je(e).includes(n))}function zt(e,n,t){return h(t,!1)?Qe(e,n).includes(t):!1}function Yt(e,n,t){return h(t,!1)?Ze(e,n).includes(t):!1}function un(e,n,t){let r=null;const o=Jt(e),s=Qt(n),i=Object.keys(o),d=Object.keys(s),l=ln(Object.keys(e)),c=ln(Object.keys(n)),u=l.filter(a=>!c.includes(a));return u.length&&(r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(n).toString()}`)),O(i,d)||(r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${i.toString()}
      Approved: ${d.toString()}`)),Object.keys(n).forEach(a=>{if(!a.includes(":")||r)return;const b=A(n[a].accounts);b.includes(a)||(r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${b.toString()}`))}),i.forEach(a=>{r||(O(o[a].methods,s[a].methods)?O(o[a].events,s[a].events)||(r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${a}`)):r=N("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${a}`))}),r}function Jt(e){const n={};return Object.keys(e).forEach(t=>{var r;t.includes(":")?n[t]=e[t]:(r=e[t].chains)==null||r.forEach(o=>{n[o]={methods:e[t].methods,events:e[t].events}})}),n}function ln(e){return[...new Set(e.map(n=>n.includes(":")?n.split(":")[0]:n))]}function Qt(e){const n={};return Object.keys(e).forEach(t=>{if(t.includes(":"))n[t]=e[t];else{const r=A(e[t].accounts);r?.forEach(o=>{n[o]={accounts:e[t].accounts.filter(s=>s.includes(`${o}:`)),methods:e[t].methods,events:e[t].events}})}}),n}function Zt(e,n){return G(e,!1)&&e<=n.max&&e>=n.min}function Xt(){const e=R();return new Promise(n=>{switch(e){case m.browser:n(dn());break;case m.reactNative:n(fn());break;case m.node:n(pn());break;default:n(!0)}})}function dn(){return q()&&navigator?.onLine}async function fn(){if(C()&&typeof global<"u"&&global!=null&&global.NetInfo){const e=await(global==null?void 0:global.NetInfo.fetch());return e?.isConnected}return!0}function pn(){return!0}function er(e){switch(R()){case m.browser:mn(e);break;case m.reactNative:yn(e);break;case m.node:break}}function mn(e){!C()&&q()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}function yn(e){C()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(n=>e(n?.isConnected))}const ae={};class nr{static get(n){return ae[n]}static set(n,t){ae[n]=t}static delete(n){delete ae[n]}}export{J as BASE10,p as BASE16,x as BASE64,Gn as COLON,ne as DEFAULT_DEPTH,H as EMPTY_SPACE,m as ENV_MAP,nr as MemoryStore,Wn as ONE_THOUSAND,Ce as REACT_NATIVE_PRODUCT,Fe as RELAYER_DEFAULT_PROTOCOL,je as SDK_TYPE,$e as SLASH,Q as TYPE_0,_ as TYPE_1,F as UTF8,De as appendToQueryString,Xn as assertType,_t as buildApprovedNamespaces,dt as calcExpiry,st as capitalize,xe as capitalizeWord,it as createDelayedPromise,ct as createExpiringPromise,j as decodeTypeByte,Ln as decrypt,kn as deriveSymKey,ee as deserialize,Pe as encodeTypeByte,Kn as encrypt,pt as engineEvent,ot as enumify,Ee as formatAccountId,Pn as formatAccountWithChain,ve as formatChainId,re as formatExpirerTarget,ut as formatIdTarget,Cn as formatMessage,et as formatMessageContext,We as formatRelayParams,Qn as formatRelayRpcUrl,at as formatTopicTarget,Me as formatUA,Ot as formatUri,jn as generateKeyPair,Dn as generateRandomBytes32,A as getAccountsChains,Rn as getAccountsFromNamespaces,be as getAddressFromAccount,Tn as getAddressesFromAccounts,Yn as getAppMetadata,dn as getBrowserOnlineStatus,zn as getBundleId,Ne as getChainFromAccount,Oe as getChainsFromAccounts,K as getChainsFromNamespace,An as getChainsFromNamespaces,Un as getChainsFromRequiredNamespaces,we as getDidAddress,L as getDidAddressSegments,Se as getDidChainId,R as getEnvironment,Zn as getHttpUrl,N as getInternalError,Ve as getJavascriptID,ke as getJavascriptOS,Le as getLastItems,_n as getNamespacedDidChainId,Je as getNamespacesChains,Ze as getNamespacesEventsForChainId,Qe as getNamespacesMethodsForChainId,pn as getNodeOnlineStatus,fn as getReactNativeOnlineStatus,Jn as getRelayClientMetadata,ht as getRelayProtocolApi,yt as getRelayProtocolName,Ut as getRequiredNamespacesFromNamespaces,U as getSdkError,Y as getUniqueValues,mt as handleDeeplinkRedirect,O as hasOverlap,Vn as hashKey,Mn as hashMessage,q as isBrowser,oe as isCaipNamespace,un as isConformingNamespaces,ft as isExpired,te as isNode,Xt as isOnline,kt as isProposalStruct,C as isReactNative,jt as isSessionCompatible,Vt as isSessionStruct,Fn as isTypeOneEnvelope,w as isUndefined,en as isValidAccountId,rn as isValidAccounts,sn as isValidActions,D as isValidArray,k as isValidChainId,nn as isValidChains,Mt as isValidController,Ht as isValidErrorReason,Gt as isValidEvent,xt as isValidId,on as isValidNamespaceAccounts,ce as isValidNamespaceActions,tn as isValidNamespaceChains,ie as isValidNamespaceMethodsOrEvents,cn as isValidNamespaces,Wt as isValidNamespacesChainId,Yt as isValidNamespacesEvent,zt as isValidNamespacesRequest,G as isValidNumber,B as isValidObject,Ft as isValidParams,an as isValidRelay,Lt as isValidRelays,qt as isValidRequest,Zt as isValidRequestExpiry,Kt as isValidRequiredNamespaces,Bt as isValidResponse,h as isValidString,Dt as isValidUrl,rt as mapEntries,nt as mapToObj,S as mergeArrays,se as normalizeNamespaces,tt as objToMap,z as parseAccountId,ge as parseChainId,Ke as parseContextNames,lt as parseExpirerTarget,Xe as parseNamespaceKey,Be as parseRelayParams,Ge as parseTopic,Nt as parseUri,Te as serialize,mn as subscribeToBrowserNetworkChange,er as subscribeToNetworkChange,yn as subscribeToReactNativeNetworkChange,xn as validateDecoding,Re as validateEncoding};
//# sourceMappingURL=index.es.js.map
